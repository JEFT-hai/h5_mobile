var H5=function(){return this.id=("h5_"+Math.random()).replace(".","_"),this.el=$('<div class="h5" id="'+this.id+'">').hide(),this.page=[],$("body").append(this.el),this.addPage=function(t,e){var a=$('<div class="h5_page section">');return void 0!=t&&a.addClass("h5_page_"+t),void 0!=e&&a.text(e),this.el.append(a),this.page.push(a),"function"==typeof this.whenAddPage&&this.whenAddPage(),this},this.addComponent=function(t,e){var e=e||{};e=$.extend({type:"base"},e);var a,n=this.page.slice(-1)[0];switch(e.type){case"base":a=new H5ComponentBase(t,e);break;case"polyline":a=new H5ComponentPolyline(t,e);break;case"pie":a=new H5ComponentPie(t,e);break;case"bar":a=new H5ComponentBar(t,e);break;case"bar_v":a=new H5ComponentBar_v(t,e);break;case"radar":a=new H5ComponentRadar(t,e);break;case"point":a=new H5ComponentPoint(t,e);break;case"ring":a=new H5ComponentRing(t,e)}return n.append(a),this},this.loader=function(){this.el.fullpage({onLeave:function(t,e,a){$(this).find(".h5_component").trigger("onLeave")},afterLoad:function(t,e){$(this).find(".h5_component").trigger("onLoad")}}),this.el.show()},this.loader="function"==typeof H5_loading?H5_loading:this.loader,this},H5_loading=function(t,e){var a=this.id;if(void 0===this._images){this._images=(t||[]).length,this._loaded=0,window[a]=this;for(s in t){var n=t[s],i=new Image;i.onload=function(){window[a].loader()},i.src=n}return $("#rate").text("0%"),this}if(this._loaded++,$("#rate").text((this._loaded/this._images*100>>0)+"%"),this._loaded<this._images)return this;window[a]=null,this.el.fullpage({onLeave:function(t,e,a){$(this).find(".h5_component").trigger("onLeave")},afterLoad:function(t,e){$(this).find(".h5_component").trigger("onLoad")}}),this.page[0].find(".h5_component").trigger("onLoad"),this.el.show(),e&&$.fn.fullpage.moveTo(e)},H5ComponentBase=function(t,e){var e=e||{},a=("h5_c_"+Math.random()).replace(".","_"),n=" h5_component_"+e.type,i=$('<div class=" h5_component '+n+" h5_component_name_"+t+'  "  id="'+a+'">');return e.text&&i.text(e.text),e.width&&i.width(e.width/2),e.height&&i.height(e.height/2),e.css&&i.css(e.css),e.bg&&i.css("background","url("+e.bg+")").css("background-size","cover"),!0===e.center&&i.css({marginLeft:e.width/4*-1+"px",left:"50%"}),"function"==typeof e.onclick&&i.on("click",e.onclick),i.on("onLoad",function(){return setTimeout(function(){i.addClass(n+"_load").removeClass(n+"_leave"),e.animateIn&&i.animate(e.animateIn)},e.delay||0),!1}),i.on("onLeave",function(){return setTimeout(function(){i.addClass(n+"_leave").removeClass(n+"_load"),e.animateOut&&i.animate(e.animateOut)},e.delay||0),!1}),i},H5ComponentBar=function(t,e){var a=new H5ComponentBase(t,e);return $.each(e.data,function(t,e){var n=$('<div class="line">'),i=$('<div class="name">'),o=$('<div class="rate">'),s=$('<div class="per">'),d=100*e[1]+"%",r="";e[2]&&(r='style="background-color:'+e[2]+'"'),o.html('<div class="bg" '+r+"></div>"),o.css("width",d),i.text(e[0]),s.text(d),n.append(i).append(o).append(s),a.append(n)}),a},H5ComponentPoint=function(t,e){var a=new H5ComponentBase(t,e),n=e.data[0][1];return $.each(e.data,function(t,e){var i=$('<div class="point point_'+t+'">'),o=$('<div class="name">'+e[0]+"</div>"),s=$('<div class="per">'+e[1]+"</div>");o.append(s),i.append(o);var d=e[1]/n*100+"%";i.width(d).height(d),e[2]&&i.css("background-color",e[2]),void 0!==e[3]&&void 0!==e[4]&&i.css("left",e[3]).css("top",e[4]),i.css("transition","all 1s "+.5*t+"s"),a.append(i)}),a.find(".point").on("click",function(){return a.find(".point").removeClass("point_focus"),$(this).addClass("point_focus"),!1}).eq(0).addClass("point_focus"),a},H5ComponentBar_v=function(t,e){var a=new H5ComponentBase(t,e);return $.each(e.data,function(t,n){var i=100/e.data.length>>0,o=$('<div class="line"></div>'),s=$('<div class="name">\t</div>'),d=$('<div class="rate">\t</div>'),r=$('<div class="per">\t</div>'),c=100*n[1]+"%";o.css("width",i+"%");var h="";n[2]&&(h='style = "background-color:'+n[2]+';"'),d.html('<div class="bg" '+h+"></div>"),d.css("height",c),s.text(n[0]),r.text(c),d.append(r),o.append(s).append(d),a.append(o)}),a},H5ComponentPolyline=function(t,e){var a=new H5ComponentBase(t,e),n=e.width,i=e.height,o=document.createElement("canvas"),s=o.getContext("2d");o.width=s.width=n,o.height=s.height=i,a.append(o);var d=10;s.beginPath(),s.lineWidth=1,s.strokeStyle="#aaaaaa",window.cxt=s;for(var r=0;r<d+1;r++){var c=i/d*r;s.moveTo(0,c),s.lineTo(n,c)}d=e.data.length+1;for(var h=n/d,r=0;r<d+1;r++){var l=n/d*r;if(s.moveTo(l,0),s.lineTo(l,i),e.data[r]){var p=$('<div class="text"></div>');p.text(e.data[r][0]),p.css("width",h/2).css("left",l/2-h/4+h/2),a.append(p)}}s.stroke(),a.append(o);var o=document.createElement("canvas"),s=o.getContext("2d");o.width=s.width=n,o.height=s.height=i;var v=function(t){s.clearRect(0,0,n,i),s.beginPath(),s.lineWidth=3,s.strokeStyle="#ff8878";var a=0,o=0,d=n/(e.data.length+1);for(r in e.data){var c=e.data[r];a=d*r+d,o=i-c[1]*i*t,s.moveTo(a,o),s.arc(a,o,5,0,2*Math.PI)}s.moveTo(d,i-e.data[0][1]*i*t);for(r in e.data){var c=e.data[r];a=d*r+d,o=i-c[1]*i*t,s.lineTo(a,o)}s.stroke(),s.lineWidth=1,s.strokeStyle="rgba(255,136,120,0)",s.lineTo(a,i),s.lineTo(d,i),s.fillStyle="rgba(255,136,120,0.2)",s.fill();for(r in e.data){var c=e.data[r];a=d*r+d,o=i-c[1]*i*t,s.fillStyle=c[2]?c[2]:"#595959",s.fillText(100*c[1]+"%",a-10,o-10)}s.stroke()};return a.on("onLoad",function(){for(var t=0,e=0;e<100;e++)setTimeout(function(){t+=.01,v(t)},10*e+500)}),a.on("onLeave",function(){for(var t=1,e=0;e<100;e++)setTimeout(function(){t-=.01,v(t)},10*e)}),a.append(o),a},H5ComponentRadar=function(t,e){var a=new H5ComponentBase(t,e),n=e.width,i=e.height,o=document.createElement("canvas"),s=o.getContext("2d");o.width=s.width=n,o.height=s.height=i,a.append(o);for(var d=n/2,r=e.data.length,c=!1,h=10;h>0;h--){s.beginPath();for(var l=0;l<r;l++){var p=2*Math.PI/360*(360/r)*l,v=d+Math.sin(p)*d*(h/10),f=d+Math.cos(p)*d*(h/10);s.lineTo(v,f)}s.closePath(),s.fillStyle=(c=!c)?"#99c0ff":"#f1f9ff",s.fill()}for(var l=0;l<r;l++){var p=2*Math.PI/360*(360/r)*l,v=d+Math.sin(p)*d,f=d+Math.cos(p)*d;s.moveTo(d,d),s.lineTo(v,f);var g=$('<div class="text">');g.text(e.data[l][0]),g.css("transition"," all .5s "+.5*l+"s"),v>n/2?g.css("left",v/2+5):g.css("right",(n-v)/2+5),f>i/2?g.css("top",f/2+5):g.css("bottom",(i-f)/2+5),e.data[l][2]&&g.css("color",e.data[l][2]),g.css("opacity",0),a.append(g)}s.strokeStyle="#e0e0e0",s.stroke();var o=document.createElement("canvas"),s=o.getContext("2d");o.width=s.width=n,o.height=s.height=i,a.append(o),s.strokeStyle="#f00";var u=function(t){t>=1&&a.find(".text").css("opacity",1),t<=1&&a.find(".text").css("opacity",0),s.clearRect(0,0,n,i);for(var o=0;o<r;o++){var c=2*Math.PI/360*(360/r)*o,h=e.data[o][1]*t,l=d+Math.sin(c)*d*h,p=d+Math.cos(c)*d*h;s.lineTo(l,p)}s.closePath(),s.stroke(),s.fillStyle="#ff7676";for(var o=0;o<r;o++){var c=2*Math.PI/360*(360/r)*o,h=e.data[o][1]*t,l=d+Math.sin(c)*d*h,p=d+Math.cos(c)*d*h;s.beginPath(),s.arc(l,p,5,0,2*Math.PI),s.fill(),s.closePath()}};return a.on("onLoad",function(){for(var t=0,e=0;e<100;e++)setTimeout(function(){t+=.01,u(t)},10*e+500)}),a.on("onLeave",function(){for(var t=1,e=0;e<100;e++)setTimeout(function(){t-=.01,u(t)},10*e)}),a.append(o),a},H5ComponentPie=function(t,e){var a=new H5ComponentBase(t,e),n=e.width,i=e.height,o=document.createElement("canvas"),s=o.getContext("2d");o.width=s.width=n,o.height=s.height=i,$(o).css("z-index",1),a.append(o);var d=n/2;s.beginPath(),s.fillStyle="#eee",s.lineWidth=1,s.arc(d,d,d,0,2*Math.PI),s.fill(),s.stroke();var o=document.createElement("canvas"),s=o.getContext("2d");o.width=s.width=n,o.height=s.height=i,$(o).css("z-index",2),a.append(o);for(var r=["red","green","blue","orange","gray"],c=1.5*Math.PI,h=0,l=2*Math.PI,p=e.data.length,v=0;v<p;v++){var f=e.data[v],g=f[2]||(f[2]=r.pop());h=c+l*f[1],s.beginPath(),s.fillStyle=g,s.strokeStyle=g,s.lineWidth=.1,s.moveTo(d,d),s.arc(d,d,d,c,h),s.fill(),s.stroke(),c=h;var u=$('<div class="text"></div>');u.text(f[0]);var m=$('<div class="per"></div>');m.text(100*f[1]+"%"),u.append(m);var w=d+Math.sin(.5*Math.PI-c)*d,x=d+Math.cos(.5*Math.PI-c)*d;w>n/2?u.css("left",w/2+5):u.css("right",(n-w)/2+5),x>i/2?u.css("top",x/2+5):u.css("bottom",(i-x)/2+5),e.data[v][2]&&u.css("color",e.data[v][2]),u.css("opacity",0),a.append(u)}var o=document.createElement("canvas"),s=o.getContext("2d");o.width=s.width=n,o.height=s.height=i,$(o).css("zIndex",3),a.append(o),s.fillStyle="#eee",s.strokeStyle="#eee",s.lineWidth=.01;var y=function(t){s.clearRect(0,0,n,i),s.beginPath(),s.moveTo(d,d),t<=0?(s.arc(d,d,d,0,2*Math.PI),a.find(".text").css("opacity",0)):s.arc(d,d,d,c,c+2*Math.PI*t,!0),t>=1&&a.find(".text").css("opacity",1),s.fill(),s.stroke()};return y(0),a.on("onLoad",function(){for(var t=0,e=0;e<100;e++)setTimeout(function(){t+=.01,y(t)},10*e+500)}),a.on("onLeave",function(){for(var t=1,e=0;e<100;e++)setTimeout(function(){t-=.01,y(t)},10*e)}),a.append(o),a},H5ComponentRing=function(t,e){var a=new H5ComponentBase(t,e),n=e.width,i=e.height,o=document.createElement("canvas"),s=o.getContext("2d");o.width=s.width=n,o.height=s.height=i,$(o).css("z-index",1),a.append(o);var d=n/2;s.beginPath(),s.fillStyle="#eee",s.lineWidth=.01,s.arc(d,d,d,0,2*Math.PI),s.fill(),s.stroke();var o=document.createElement("canvas"),s=o.getContext("2d");o.width=s.width=n,o.height=s.height=i,$(o).css("z-index",2),a.append(o);for(var r=["red","green","blue","orange"],c=1.5*Math.PI,h=0,l=2*Math.PI,p=e.data.length,v=0;v<p;v++){var f=e.data[v],g=f[2]||(f[2]=r.pop());h=c+l*f[1],s.beginPath(),s.fillStyle=g,s.strokeStyle=g,s.lineWidth=.1,s.moveTo(d,d),s.arc(d,d,d,c,h),s.fill(),s.stroke(),c=h;var u=$('<div class="text"></div>');u.text(f[0]);var m=$('<div class="per"></div>');m.text(100*f[1]+"%"),u.append(m),e.data[v][2]&&u.css("color",e.data[v][2]),u.css("opacity",0);var w=$('<div class="mask"></div>');a.append(w),w.append(u)}var o=document.createElement("canvas"),s=o.getContext("2d");o.width=s.width=n,o.height=s.height=i,$(o).css("zIndex",3),a.append(o),s.fillStyle="#eee",s.strokeStyle="#eee",s.lineWidth=.01;var x=function(t){s.clearRect(0,0,n,i),s.beginPath(),s.moveTo(d,d),t<=0?(s.arc(d,d,d,0,2*Math.PI),a.find(".text").css("opacity",0)):s.arc(d,d,d,c,c+2*Math.PI*t,!0),t>=1&&a.find(".text").css("opacity",1),s.fill(),s.stroke()};return x(0),a.on("onLoad",function(){for(var t=0,e=0;e<100;e++)setTimeout(function(){t+=.01,x(t)},10*e+500)}),a.on("onLeave",function(){for(var t=1,e=0;e<100;e++)setTimeout(function(){t-=.01,x(t)},10*e)}),a.append(o),a};